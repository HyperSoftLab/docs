# Трассировка в GMonit

Термин "трассировка" обычно используется для обозначения различных методов получения информации о том, как работает программа или система. Например, "stack trace" предоставляет подробную информацию о подпрограммах.

В случае крупных современных систем, которые распределены между многими сервисами и микросервисами, под трассировкой имеют в виду распределенную трассировку. Это метод мониторинга запросов по мере их прохождения через сложную распределенную среду.
Распределенная трассировка отслеживает запросы в системе и представляет данные трассировки в виде `Span` объектов с парами ключ-значение.

## Семплирование

APM-агенты используют адаптивное семплирование для захвата активности системы. Первый сервис в трассировке, называемый исходной трассировкой("trace origin"), случайным образом выбирает запросы для трассировки, что распространяется на сервисы, затронутые этим запросом. 
По умолчанию, агент выбирает 10 трассировок в минуту и учитывает количество транзакций в предыдущую минуту. Если, например, в предыдущую минуту было 100 транзакций, агент выберет 1 из каждых 10 для выборки.
Агенты ограничивают количество спанов до 2000 в минуту, отбрасывая спаны с более низким приоритетом, если это необходимо для сохранения трассировок с высоким приоритетом, что может привести к фрагментации трассировки в интерфейсе.


## Структура хранения трассировки

Данные распределенной трассировки хранятся в таблице `traces_v2`


